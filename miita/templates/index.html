{% extends 'layout.html' %}
{% block content %}
    <div class="row-fluid">
        <div class="span9">
            {% if selected_tag is defined -%}
            <h2>{{ selected_tag }}
                {% if selected_tag in user.follow_tags %}
                    <small>フォロー済み</small>
                {% else %}
                    <small><a href="#" id="btn-follow-tag" data-tag="{{ selected_tag }}">このタグをフォローする</a></small>
                {% endif %}
            </h2>
            {%- else -%}
            <h2>最近の投稿</h2>
            {%- endif %}
            {% for article in articles %}
                <article class="summary">
                    <h3>
                    <a href="{{ url_for('.items', item_id=article.id) }}">{{ article.title }}</a>
                    </h3>
                        {% for tag in article.tags %}{{ taglink(tag) }}{% endfor %}
                    <div>
                        {{ article.html|safe }}
                    </div>
                </article>
            {% endfor %}
        </div>
        <div class="span3">
            <a class="btn btn-primary" href="{{ url_for('.edit') }}">新しい記事を投稿する</a>
            <br>
        <h3>フォローしているタグ</h3>
            <ul>
                {% for tag in user.follow_tags %}
                <li>{{ taglink(tag) }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <script>
    jQuery('#btn-follow-tag').on('click', function(source) {
        jQuery.ajax("{{ url_for('.follow') }}?tag=" + source.target.getAttribute('data-tag'));
    });
    </script>
{% endblock %}
